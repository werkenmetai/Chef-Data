# Week 6, 2026 (3 feb - 9 feb)

> **Strategische Koers:** ğŸ“¢ **PUBLICATIE WEEK** - Van technisch naar markt!
>
> **Matthijs Update (1 feb):** "Het team werkt zo hard en deployed zo snel dat je een maand werk in een week kan plannen. Kijk naar de resultaten van deze week." â†’ We schalen de ambities op!

## Context uit Week 5

### Technische Successen (31 jan)
| Metric | Voor | Na |
|--------|------|-----|
| Live test failure rate | 57% | **0%** |
| Tools werkend | 6/46 | **36/46** |
| Module N/A (niet testbaar) | 8 | 10 |
| API velden geverifieerd | Nee | **100%** |

### Matthijs' Strategisch Oordeel (Week 5)
```
WAARSCHUWING: We zijn in de "technical perfection trap" gevallen.

Week 5 was productief qua techniek, maar de App Store publicatie
voortgang was minimaal.

AANBEVELING: Week 6 = 80% business, 20% tech
```

---

## ğŸ† App Store Status (Updated 1 feb)

| Tab | Stap | Status | Datum |
|-----|------|--------|-------|
| **LATEN BEOORDELEN** | Gegevens en beveiliging | âœ… GOEDGEKEURD | 29 jan |
| **LATEN BEOORDELEN** | Toestemmingsverzoek | âœ… GOEDGEKEURD | 29 jan |
| **PUBLICEREN** | Marketingbeoordeling | âœ… INGEDIEND | 1 feb |
| **PUBLICEREN** | Kosten (partnermanager) | âœ… â‚¬0 - GEEN KOSTEN | 3 feb |
| **PUBLICEREN** | Factureringsgegevens | âœ… Kan ingevuld (â‚¬0) | 3 feb |
| **PUBLICEREN** | Demonstratie | â¬œ Laatste stap | - |

---

## ğŸ”¥ NIET ONDERHANDELBAAR - Business (80%)

### 1. Marketingbeoordeling âœ… INGEDIEND
**Eigenaar:** CEO
**Status:** âœ… Ingediend 1 feb 2026

**Voltooid:**
- [x] App naam: "Praat met je Boekhouding"
- [x] Korte beschrijving (150 tekens)
- [x] Lange beschrijving (2000 tekens)
- [x] Screenshots uploaden
- [x] Logo (512x512 PNG) - âš ï¸ Te groot, moet gecomprimeerd
- [x] Categorie geselecteerd
- [x] Doelgroep gedefinieerd

### 2. Contact Partnermanager - Kosten âœ… AANGEVRAAGD
**Eigenaar:** CEO
**Status:** âœ… Afspraak aangevraagd 1 feb 2026

**Update 2 feb:**
- [x] Partner Marketing Guidelines ontvangen van Exact
- [x] Lange omschrijving en links reeds aangepast door Matthijs
- [x] Email beantwoord aan Exact

**âœ… Afgerond (3 feb 2026):**
- [x] Kosten: â‚¬0 - geen kosten (zichtbaar in App Store portal)
- [x] Geen revenue share nodig
- [x] Geen prijsmodel onderhandeling nodig

### 3. Demo Voorbereiden
**Eigenaar:** CEO
**Deadline:** Vrijdag 7 feb

- [ ] Demo script schrijven (5 min flow)
- [ ] Demo account klaar (Demo Mode of Beurs van Berlage)
- [ ] ChatGPT + Claude beide werkend
- [ ] Backup plan als iets faalt

---

## ğŸš€ AI Platform Expansie (NIEUW)

> Het team levert op hoog tempo. We pakken deze week ook de platform uitbreidingen op.

### 4. ChatGPT Apps - Connector Lanceren
**Eigenaar:** Ruben + CEO
**Prioriteit:** ğŸ”´ HOOG

**Wat:** Een App lanceren in ChatGPT die gebruikers kunnen toevoegen als connector.

**Taken:**
- [ ] ChatGPT Apps developer portal toegang verifiÃ«ren
- [ ] App "Praat met je Boekhouding" aanmaken
- [ ] MCP endpoint configureren als connector
- [ ] Beschrijving + logo uploaden (Nederlandse tekst)
- [ ] Submit voor review

**Documentatie:** https://platform.openai.com/docs/actions

### 5. Claude Connector Directory âœ… INGEDIEND
**Eigenaar:** Ruben + Daan + CEO
**Prioriteit:** ğŸ”´ HOOG

**Status (1 feb 2026):** ğŸ† FORMULIER INGEDIEND

**Wat is gedaan:**
- âœ… OAuth 2.1 + PKCE volledig geÃ¯mplementeerd
- âœ… SSE + Streamable HTTP transport operationeel
- âœ… Tool Annotations toegevoegd aan alle 47 tools (readOnlyHint, etc.)
- âœ… Demo URL: `https://api.praatmetjeboekhouding.nl/demo/exa_demo` (NIEUW - geen OAuth)
- âœ… 6-pagina formulier volledig ingevuld
- âœ… Directory submission ingediend bij Anthropic

**Formulier secties:**
1. âœ… Basic Info (naam, beschrijving, pricing)
2. âœ… Authentication (OAuth, Streamable HTTP)
3. âœ… Test Account (demo mode, setup instructions)
4. âœ… Server Details (47 tools lijst, annotations)
5. âœ… Skills & Plugins (overgeslagen - toekomstige feature)
6. âœ… Checklist (policy, technical, docs compliance)

**Wacht op:**
- [ ] Review door Anthropic team
- [ ] Listing in claude.com/connectors

**Toekomstige features (BACKLOG):**
- MCP Prompts (workflow templates)
- Claude Agent Skills
- Claude Code Plugin

**Documentatie:** `docs/knowledge/mcp/LESSONS-LEARNED.md` (Claude Connector vereisten)

### 6. Gemini Integratie (Research)
**Eigenaar:** Ruben
**Prioriteit:** ğŸŸ¢ LATER

**Taken:**
- [ ] Google AI Studio MCP support onderzoeken
- [ ] Technische haalbaarheid documenteren
- [ ] Roadmap item voor Week 7/8

---

## ğŸ“‹ Technisch Onderhoud

**P23: Document Downloaden** âœ… DONE (tool #47)

**VERSION.md bijwerken**
```
Ruben + Joost, update VERSION.md met huidige capabilities
```

### âœ… VOLTOOID: Demo URL Fix voor Claude Desktop
**Eigenaar:** Ruben + Daan
**Prioriteit:** ğŸ”´ HOOG (blokkeert Anthropic review)
**Taak:** [TASK-W06-demo-url-claude-desktop.md](../tasks/TASK-W06-demo-url-claude-desktop.md)

**Probleem:** Demo URL `/mcp/exa_demo` werkte niet als Custom Server door OAuth discovery.

**Oplossing:** Nieuw `/demo/{demo_key}` endpoint dat OAuth volledig skipt.

**Nieuwe Demo URL:**
```
https://api.praatmetjeboekhouding.nl/demo/exa_demo
```

**Taken:**
- [x] Nieuw `/demo/{demo_key}` endpoint toegevoegd
- [x] OAuth discovery bypass voor demo paths
- [x] API testen succesvol (GET, POST, tools/list, tools/call)
- [x] Gedocumenteerd in LESSONS-LEARNED.md
- [x] Testen in Claude Desktop UI â†’ Bug #5826 in Claude Desktop
- [x] Workaround via `mcp-remote` + config file

**Claude Desktop Custom Connector Bug (#5826):**
De Custom Connector UI in Claude Desktop werkt niet correct voor remote servers.
Workaround: Configureer via `claude_desktop_config.json` met `mcp-remote`.

### âœ… VOLTOOID: Claude Desktop Installer Scripts (1 feb 2026)
**Eigenaar:** Daan + Ruben
**PRs:** #148, #149, #150, #151

**Problemen opgelost:**
| Issue | Fix | PR |
|-------|-----|-----|
| Windows BOM in JSON | `[IO.File]::WriteAllText` met UTF8Encoding($false) | #149 |
| Corrupte npm cache | Cache cleanup scripts | #150 |
| Protocol versie mismatch | Negotiate 2025-06-18 / 2025-11-25 | #151 |
| npx prompts | `-y` flag toegevoegd | #150 |

**Installer Scripts:**
| Script | Doel | URL |
|--------|------|-----|
| `install-claude-desktop.*` | Demo (geen login) | `/mcp/exa_demo` |
| `install-production.*` | Productie (OAuth) | `/mcp` |

**Setup Pagina Updates:**
- âœ… Windows BOM fix in code snippets
- âœ… Demo sectie met uitklapbare config
- âœ… `mcp-remote` i.p.v. `@anthropic/mcp-remote`
- âœ… `-y` flag voor npx

---

## ~~Originele Dagplanning~~ (Vervangen door GeÃ¼pdatete versie hieronder)

*Zie "GeÃ¼pdatete Dagplanning Week 6" sectie voor actuele planning met audit fixes.*

---

## Risico's en Mitigatie

| Risico | Impact | Mitigatie |
|--------|--------|-----------|
| Partnermanager reageert niet | Vertraging | LinkedIn backup contacten |
| Screenshots niet goed genoeg | Afwijzing | Demo Mode gebruiken |
| Onverwachte tech issues | Afleiding | NIET fixen tenzij blokkerend |

---

## Wat we NIET doen

Om focus te houden:
- âŒ Write operations implementeren (te risicovol zonder validatie)
- âŒ Multi-provider support (Moneybird, Twinfield) - focus op Exact excellence
- âŒ WhatsApp/Telegram integratie - afleiding van core
- âŒ Grote refactoring zonder directe waarde

---

## Materialen Nodig

### Screenshots te maken
1. **ChatGPT Connector:** "Welke facturen staan nog open?" â†’ Tabel met facturen
2. **Claude Desktop:** "Wat is mijn cashflow deze maand?" â†’ Forecast grafiek
3. **Dashboard:** Verbonden administratie met API usage

### App Beschrijving Template
```
KORT (150 tekens):
Vraag je boekhouding in natuurlijke taal via ChatGPT of Claude.
Privacy-first, read-only, voor ZZP en MKB.

LANG (2000 tekens):
[Wordt maandag geschreven]
```

---

## Notities

### âœ… Expert Prompt Handboek (2 feb 2026)
**Van:** Matthijs
**Status:** âœ… LIVE (PR #167, #168)

**Wat is gebouwd:**
- Pagina `/prompts` (NL) en `/en/prompts` (EN)
- **Authenticatie:** Alleen voor ingelogde klanten (redirect naar /connect)
- **8 expert categorieÃ«n** voor financiÃ«le professionals:
  1. CFO Dashboard & Stuurinformatie
  2. Credit Control & Debiteurenbeheer
  3. Controller Toolkit & Kostenanalyse
  4. Audit & Compliance
  5. Project Winstgevendheid
  6. Treasury & Cashflow Management
  7. Power User Exports
  8. AI-Gestuurde Inzichten
- **32 diepgaande expert prompts** met output format guidance
- Copy-to-clipboard functionaliteit

**Output Formats Guide:**
| Format | Instructie |
|--------|-----------|
| Excel/CSV | "Formatteer als CSV met kolomkoppen" |
| JSON Dashboard | "Geef als nested JSON voor widgets" |
| Audit Trail | "Formatteer als audit-ready met datum, bron, bedrag" |
| Mermaid Diagram | "Visualiseer als Mermaid flowchart" |
| Power BI Ready | "Formatteer als Power BI-compatible JSON" |

**Besluit tracking:** Website analytics volstaat voor click tracking - geen custom API nodig.

---

### Week 5 Overloop (31 jan 2026)
Ondanks de focus op "80% business, 20% tech" is er een **massieve technische sprint** uitgevoerd die de customer ops basis legt:

**Commits geleverd:**
- `f1735c9` Google-style app launcher in admin header
- `e9498de` Customer communications met reply functionaliteit
- `e7ee689` Unified communications widget admin dashboard
- `af45bd4` Exact Online billing integration
- `bfc3d19` Proactive outreach engine
- `56d58e1` AI Customer Ops (templates, feature flags)

**Waarom dit waardevol is:**
1. **Screenshots** - We hebben nu veel mooiere admin schermen
2. **Demo** - Customer comm platform is demo-waardig
3. **Support readiness** - Zodra klanten komen, is support infra klaar

**Migration nodig:** `0018_communication_events.sql` moet gedraaid worden op D1

---

## Update 31 jan 2026 (sessie middag)

### âœ… Voltooid
| Taak | Status | Details |
|------|--------|---------|
| Migration draaien | âœ… | `0018_communication_events.sql` succesvol op D1 |
| App Launcher op alle pages | âœ… | 22 admin pagina's bijgewerkt |
| TypeScript CI fixes | âœ… | 9 errors gefixed (type assertions) |
| Exact Billing Webhook | âœ… | `/api/exact/webhook.ts` - volledige lifecycle |
| Pricing Upgrade Flow | âœ… | Modal + App Store redirect (wanneer live) |

### Exact Online Billing Integration
**Endpoint:** `https://praatmetjeboekhouding.nl/api/exact/webhook`

**Ondersteunde events:**
- `subscription_created` â†’ Immediate upgrade
- `subscription_upgraded` â†’ Immediate upgrade
- `subscription_downgraded` â†’ Scheduled at period end
- `subscription_cancelled` â†’ Downgrade to free
- `subscription_renewed` â†’ Apply pending downgrades
- `trial_started/ended` â†’ Status update
- `payment_succeeded/failed` â†’ Status update

**Config nodig:**
- [ ] `EXACT_WEBHOOK_SECRET` in Cloudflare env
- [ ] Webhook URL registreren bij Exact
- [ ] Na publicatie: `EXACT_APP_STORE_ENABLED = true` zetten

### Cloudflare Alert
âš ï¸ **Requests vandaag:** 163,568 / 100,000 (over limit)
- Check analytics voor anomalieÃ«n
- Overweeg rate limiting implementatie

---

## ğŸ” Specialist Audit Resultaten (1 feb 2026)

### Scores Overzicht
| Specialist | Score | Status |
|------------|-------|--------|
| **Ruben** (MCP) | 9.5/10 | âœ… GROEN LICHT |
| **Joost** (Exact) | 9.5/10 | âœ… PRODUCTION READY |
| **Bas** (Security) | 7.5/10 | âš ï¸ 3 issues (grotendeels gefixed) |
| **Daan** (Backend) | 6.5/10 | âš ï¸ Cloudflare + starter plan |
| **Tom** (Marketing) | 8/10 | âœ… Logo + sitemap + blogs DONE |

**Gemiddelde: 8.2/10** - Solide basis, klaar voor launch.

### Kritieke Audit Bevindingen

| Issue | Eigenaar | Effort | Status |
|-------|----------|--------|--------|
| Cloudflare 163K requests onderzoeken | Daan | 2h | ğŸ”´ OPEN (backend) |
| ~~Logo comprimeren (1.4MB â†’ 58KB)~~ | Tom | 30m | âœ… DONE |
| 'starter' plan toevoegen aan api-key.ts | Daan | 1h | ğŸ”´ OPEN (backend) |
| ~~Sitemap fixen~~ | Tom | 15m | âœ… DONE |
| ~~3 blog posts publiceren~~ | Tom/Anna | 3h | âœ… DONE |
| Email HTML escaping | Daan | 1h | ğŸŸ¡ HOOG |
| Admin auth centraliseren | Daan | 1h | ğŸŸ¡ HOOG |
| Database index toevoegen | Daan | 30m | ğŸŸ¡ HOOG |

---

## ğŸ› Issues Status (uit KNOWN-ISSUES.md)

### ISSUE-001: "Toegang verlenen" knop reageert niet âœ… GEFIXED
**Eigenaar:** Lars
**Fix:** JavaScript handlers + visuele feedback ("Bezig...")
**Commit:** `ca7d1ef`
**Status:** âœ… GEFIXED (1 feb 2026)

### ISSUE-002: Filter knoppen op blog pagina werken niet âœ… GEFIXED
**Eigenaar:** Lars
**Fix:** URL parameter parsing + server-side filtering
**Commit:** `ca7d1ef`
**Status:** âœ… GEFIXED (1 feb 2026)

### ISSUE-003: OAuth token refresh werkt niet betrouwbaar âœ… GEFIXED
**Eigenaar:** Daan (via Piet orchestratie)
**Issue:** #123
**PR:** #136
**Status:** âœ… GEFIXED (1 feb 2026)

**Probleem:** Token refresh faalde permanent zonder retry, users moesten opnieuw inloggen.

**Oplossing:** Retry mechanism met exponential backoff (5 pogingen over ~31 uur):
- Nieuwe `retry_pending` status
- Migratie 0024 voor retry tracking columns
- Automatische migratie van bestaande `refresh_failed` connections

---

## ğŸ“‹ GeÃ¼pdatete Dagplanning Week 6

### Maandag 3 feb
| Tijd | Taak | Type | Eigenaar |
|------|------|------|----------|
| 09:00 | **Demo URL fix Claude Desktop** | ğŸ”´ Tech | Ruben + Daan |
| 10:00 | Logo comprimeren naar <300KB | ğŸ”´ Business | Tom |
| 11:00 | 'starter' plan type fix | ğŸ”´ Tech | Daan |
| 14:00 | Cloudflare requests onderzoeken | ğŸ”´ Tech | Daan |
| 15:00 | Sitemap cleanup (verwijder broken URLs) | ğŸ”´ Business | Tom |

### Dinsdag 4 feb
| Tijd | Taak | Type | Eigenaar |
|------|------|------|----------|
| 09:00 | **AUDIT-P2: Webhook secret verplicht** | ğŸ”´ Security | Daan |
| 10:00 | **AUDIT-P2: Rate limiting webhook** | ğŸ”´ Security | Daan |
| 11:00 | **AUDIT-P2: Persistent audit logging** | ğŸ”´ Security | Daan |
| 14:00 | Blog post 1 publiceren | ğŸŸ¡ Business | Anna |
| 15:00 | ISSUE-002: Docs filter knoppen | ğŸŸ¡ Tech | Lars |

### Woensdag 5 feb
| Tijd | Taak | Type | Eigenaar |
|------|------|------|----------|
| 09:00 | **LEGAL-P1: Privacy Policy v1.1 update** | ğŸ”´ Legal | Eva + Lars |
| 10:00 | **LEGAL-P1: Verwerkersovereenkomst + Resend** | ğŸ”´ Legal | Eva |
| 11:00 | **ChatGPT Apps: Developer portal setup** | ğŸ”´ Feature | Ruben |
| 14:00 | Demo script finaliseren | ğŸ”´ Business | CEO |
| 15:00 | Review alle fixes (security + legal) | ğŸŸ¡ Tech | Wim |

### Donderdag 6 feb
| Tijd | Taak | Type | Eigenaar |
|------|------|------|----------|
| 09:00 | Partnermanager response opvolgen | ğŸ”´ Business | CEO |
| 10:00 | **ChatGPT Apps: Connector aanmaken** | ğŸ”´ Feature | Ruben |
| 11:00 | **Claude toegang: Onboarding review** | ğŸ”´ Feature | Daan |
| 14:00 | AUDIT-P3: Email validatie + LIKE sanitize | ğŸŸ¡ Security | Lars |
| 15:00 | Demo voorbereiden en testen | ğŸ”´ Business | CEO |

### Vrijdag 7 feb
| Tijd | Taak | Type | Eigenaar |
|------|------|------|----------|
| 09:00 | Demo dry-run | ğŸ”´ Business | CEO |
| 10:00 | **ChatGPT Apps: Submit voor review** | ğŸ”´ Feature | Ruben |
| 11:00 | **Gemini: Research haalbaarheid** | ğŸŸ¢ Research | Ruben |
| 14:00 | Google Search Console opzetten | ğŸŸ¡ Business | Tom |
| 15:00 | Week review + Week 7 plannen | ğŸ”´ Business | Piet |

---

## âœ… Updated Success Criteria

### Kritieke Fixes (Maandag)
| Criterium | Must/Should/Could |
|-----------|-------------------|
| **Demo URL werkt in Claude Desktop** | **MUST** |
| Logo gecomprimeerd (<300KB) | **MUST** |
| 'starter' plan type gefixed | **MUST** |
| Sitemap cleaned (geen 404s) | **MUST** |

### Security Audit Fixes (Dinsdag) ğŸ†•
| Criterium | Must/Should/Could |
|-----------|-------------------|
| **AUDIT-P2: Webhook secret verplicht** | **MUST** |
| **AUDIT-P2: Rate limiting webhook** | **MUST** |
| **AUDIT-P2: Persistent audit logging** | **MUST** |

### Legal Audit Fixes (Woensdag) ğŸ†•
| Criterium | Must/Should/Could |
|-----------|-------------------|
| **LEGAL-P1: Privacy Policy v1.1** | **MUST** |
| **LEGAL-P1: Verwerkersovereenkomst v1.1 (Resend)** | **MUST** |
| **LEGAL-P2: ToS Artikel 4A (Support)** | **SHOULD** |

### Open Issues (Di-Do)
| Criterium | Must/Should/Could |
|-----------|-------------------|
| ISSUE-001 gefixed | **SHOULD** |
| ISSUE-002 gefixed | **SHOULD** |
| 3 blog posts live | **SHOULD** |
| AUDIT-P3: Email validatie verbeteren | **SHOULD** |
| AUDIT-P3: LIKE query sanitizen | **SHOULD** |
| AUDIT-P3: Rate limiting reply API | **COULD** |
| AUDIT-P3: Basis spam filtering | **COULD** |

### AI Platform Expansie (Wo-Vr) ğŸ†•
| Criterium | Must/Should/Could |
|-----------|-------------------|
| ChatGPT Apps: Connector aangemaakt | **MUST** |
| ChatGPT Apps: Submitted voor review | **SHOULD** |
| Claude toegang: Onboarding compleet | **MUST** |
| Gemini: Haalbaarheid gedocumenteerd | **COULD** |

### Business (Doorlopend)
| Criterium | Must/Should/Could |
|-----------|-------------------|
| Demo script klaar | **MUST** |
| Partnermanager response | **MUST** |
| Google Search Console live | **COULD** |

---

## Vrijdag Review

### Wat is gelukt?

**Business & Compliance:**
- âœ… Security audit: ORANJE â†’ GROEN (P2: webhook secret, audit log, rate limiting docs)
- âœ… Legal audit: ROOD â†’ GROEN (Privacy Policy v1.1, ToS v1.1, Verwerkersovereenkomst v1.1)
- âœ… Demo script finaliseerd (PR #205)
- âœ… Partnermanager kosten bevestigd: â‚¬0

**Content Machine:**
- âœ… Workflow Recipes Content Plan compleet (30 topics, 6 categorieÃ«n)
- âœ… Eerste blog live: "Automatische Factuurherinneringen met AI"
- âœ… 3 workflow recipe blogs voorbereid voor W07
- âœ… ISSUE-004 opgelost: alle blogs herschreven voor menselijke leesbaarheid
- âœ… 6 product blogs herschreven (menselijk taalgebruik)
- âœ… 17 MCP tools blog herschreven
- âœ… ChatGPT koppeling blog herschreven
- âœ… Blog headers visueel verbeterd ("sexy headers")
- âœ… Blog readability spacing fix (CSS)
- âœ… Blog schrijfrichtlijnen gedocumenteerd (LESSON-001)

**Techniek:**
- âœ… P36 AI Support Agent met email escalatie loop (PR #227)
- âœ… Admin inbox + signature settings compleet
- âœ… Klantreis dashboard gebouwd
- âœ… Developer page voor klanten
- âœ… SEO fixes: robots.txt, sitemap, og-image, meta tags
- âœ… Security: publieke /tools endpoint verwijderd, auth verplicht
- âœ… TypeScript CI fixes
- âœ… 47 branches opgeruimd â†’ alleen main

**PRs gemerged deze week:** 55+ (nieuw record)

### Wat niet?
- â¬œ ChatGPT Apps submission (account verificatie nodig door Matthijs)
- â¬œ Cloudflare rate limiting configureren (handmatige actie in dashboard)
- â¬œ Demo dry-run (wacht op partnermanager afspraak)
- â¬œ Partnermanager demonstratie (wacht op reactie Exact)

### Learnings
1. **Content als strategie**: Shift van "query tool" naar "workflow hub" opent nieuwe positionering
2. **MCP chaining**: Multi-tool workflows (Exact + Gmail + Sheets) zijn de toekomst
3. **BTW voorzichtigheid**: FinanciÃ«le content altijd framen als "voorbereiding", niet als definitieve aangifte
4. **Team velocity**: 11 PRs in Ã©Ã©n dag mogelijk met goede orchestratie
5. **Blog leesbaarheid**: AI-geschreven content moet ALTIJD herschreven worden voor menselijke leesbaarheid. Kortere zinnen, meer witruimte, geen tool-namen maar benefits
6. **GitHub hygiene**: Start elke sessie met branch cleanup, anders groeien stale branches snel
7. **Security proactief**: Audits vroeg doen bespaart werk later. ORANJE/ROOD â†’ GROEN in 24 uur

### Focus volgende week (W07)
1. **Content Machine draaien**: 3 blogs publiceren (BTW Sheets, Betalingsbevestigingen, Betaaldeadlines)
2. **ChatGPT Apps**: Matthijs moet account verifiÃ«ren + submission
3. **Demo**: Exact App Store demonstratie zodra afspraak staat
4. **Partnermanager**: Response opvolgen

---

## Gebouwd op 2 feb 2026

### Customer Communication Fixes âœ… (PR #153)
| Component | Status | Beschrijving |
|-----------|--------|--------------|
| **Message Direction Fix** | âœ… | Admin replies nu correct als "Van ons" getoond (was "Van jou") |
| **Dashboard Layout** | âœ… | "Mijn Berichten" sectie verplaatst boven "Exact Online Connecties" |
| **Customer Profile Fix** | âœ… | Correcte tabelnaam `admin_response_templates` i.p.v. `response_templates` |

### Pricing & Messages UI (PR #154)
| Component | Status | Beschrijving |
|-----------|--------|--------------|
| **Pricing Buttons** | âœ… | "Downgrade naar X" wanneer lager plan, "Upgrade naar X" wanneer hoger |
| **Message Category Labels** | âœ… | Bug (rood), Feature (groen), Vraag (cyan), Feedback (geel) |
| **Message Detail Modal** | âœ… | Klik op bericht opent modal met volledige inhoud |
| **Reply from Modal** | âœ… | Reageer knop in modal opent compose met prefilled subject |

### Commits (2 feb)
```
c5d929e Merge pull request #154 - pricing buttons and message UI
e14cb96 feat: improve pricing buttons and message UI
eaf1bbd Merge pull request #153 - fix messages and dashboard
1e7a002 fix: message direction and dashboard layout improvements
```

---

## Division Management Improvements (2 feb 2026 - sessie 2)

### Probleemanalyse
Gebruikers konden divisies aan/uit zetten (`is_active`) maar:
1. MCP server negeerde `is_active` - stuurde alle divisies naar AI
2. Als default divisie werd uitgeschakeld, bleef die toch default
3. Geen manier om snel alle divisies te activeren

### Oplossing: Smart Division Management

| Component | Wijziging | Bestand |
|-----------|-----------|---------|
| **MCP Server Filtering** | Alleen actieve divisies (`is_active=1`) naar AI | `api-key.ts:307-330` |
| **DivisionInfo Interface** | `isActive: boolean` toegevoegd | `api-key.ts:36-40` |
| **Smart Resolution** | `resolveDivisionWithContext()` met hints | `_base.ts:265-310` |
| **Default Rotation** | Auto-nieuwe default bij deactiveren | `database.ts:896-930` |
| **Bulk Activate** | `activateAllDivisions()` method | `database.ts:938-1000` |
| **API Endpoint** | `action: 'activate_all'` support | `toggle.ts:52-80` |
| **Dashboard UI** | "Alles activeren" button | `dashboard.astro:916-928` |
| **Demo Contexts** | `isActive: true` toegevoegd | `context.ts` (4 locaties) |

### Nieuwe Flow
```
Gebruiker heeft 5 divisies, plan limiet is 3:

1. "Alles activeren" â†’ 3 van 5 geactiveerd (met melding)
2. AI krijgt alleen actieve divisies
3. Als 1 actief: automatisch gebruik
4. Als meerdere: AI kiest op basis van context of vraagt
5. Default uitschakelen â†’ automatisch nieuwe default uit actieve
```

### API Wijzigingen

**POST /api/divisions/toggle**
```json
// Bestaand (single toggle)
{ "divisionId": "xxx", "active": true }

// Nieuw (bulk activate)
{ "action": "activate_all" }
```

**Response (bulk activate)**
```json
{
  "success": true,
  "activeDivisions": 3,
  "total": 5,
  "planLimit": 3,
  "limited": true,
  "message": "3 van 5 administraties geactiveerd (plan limiet)"
}
```

---

## ğŸ’¡ Brainstorm Sessie (2 feb 2026 - onderweg)

> Matthijs dropte ideeÃ«n tijdens reis. Besproken, niet uitgevoerd.

### Beslissing 1: API Keys naar Developer Tab
**Status:** ğŸ“‹ BACKLOG
**Eigenaar:** Daan + Lars

**Probleem:** API keys zijn te prominent bij eerste login, terwijl OAuth de primaire flow is.

**Besluit:**
- Verberg API keys achter "Developer" of "Geavanceerd" tab
- Focus eerste scherm op onboarding/dashboard
- MCP toevoegen moet < 5 minuten zijn via:
  - App stores (Exact, Claude, ChatGPT)
  - Copy-paste instructies die 100% voorgekauwd zijn

### Beslissing 2: Config File Users â†’ Verplicht OAuth
**Status:** ğŸ“‹ BACKLOG
**Eigenaar:** Ruben + Daan

**Probleem:** Users die via `claude_desktop_config.json` verbinden zijn onzichtbaar (geen database entry, geen billing, geen support).

**Besluit:**
- MCP endpoint checkt of user bekend is
- Zo niet â†’ redirect naar OAuth flow
- Alle users worden zichtbaar in database
- Lost "ghost users" probleem op

**Technisch:**
```
User configureert MCP â†’ eerste API call â†’
niet bekend? â†’ return auth URL â†’ user logt in â†’
nu in database â†’ normale flow
```

### Beslissing 3: Klantreis Dashboard (Admin)
**Status:** ğŸ”´ PRIORITEIT
**Eigenaar:** Daan + Lars

**Probleem:** Geen overzicht van customer journey en contactpunten.

**Besluit:** Bouw uitgebreid admin dashboard met:

**Customer Journey Visualisatie:**
- Alle touchpoints (landing â†’ connect â†’ vraag â†’ support â†’ upgrade)
- Conversie per stap
- Drop-off punten

**Stats (alle relevante metrics):**
- DAU / WAU / MAU (actieve gebruikers)
- Vragen per dag / per user
- API calls totaal + per endpoint
- Error rates
- Response times
- Token refresh success/failure
- Plan distributie (free/starter/pro)
- Upgrade/downgrade bewegingen
- Support tickets open/gesloten
- Gemiddelde response tijd support
- Meest gebruikte tools
- Divisies per user gemiddeld

**Doel:** Matthijs kan dit laten zien in demo's en zelf monitoren.

### Beslissing 4: Communicatie Security Audit
**Status:** ğŸ”´ DEZE WEEK
**Eigenaar:** Bas (audit) + Daan (fixes)

**Vraag:** Is ons interne berichtensysteem veilig?

**Te checken:**
- [ ] Berichten encrypted at rest in D1?
- [ ] XSS sanitization bij weergave?
- [ ] Rate limiting op message endpoints?
- [ ] Admin auth check op alle message routes?
- [ ] Audit log wie wat leest?
- [ ] Input validation op message content?

### Beslissing 5: Bijlagen in Berichten
**Status:** ğŸ“‹ BACKLOG (belangrijk)
**Eigenaar:** Daan + Lars

**Probleem:** Klanten kunnen geen bijlagen sturen (screenshots, exports).

**Besluit:** Implementeer file uploads met R2.

**Specificaties:**
- **Opslag:** Cloudflare R2 (al beschikbaar)
- **Max file size:** R2 limiet (geen kunstmatige beperking)
- **File types:** Alles wat R2 accepteert
- **UI:** Upload in message compose, preview in message view
- **Security:** Virus scan? File type validation?

**Use cases:**
- Klant stuurt screenshot van foutmelding
- Klant stuurt export ter verificatie
- Admin stuurt handleiding/PDF

---

## Samenvatting Brainstorm â†’ Acties

| # | Beslissing | Prioriteit | Eigenaar |
|---|------------|------------|----------|
| 1 | API keys â†’ Developer tab | ğŸŸ¡ Backlog | Daan/Lars |
| 2 | Config users â†’ OAuth verplicht | ğŸŸ¡ Backlog | Ruben/Daan |
| 3 | Klantreis dashboard | ğŸ”´ Hoog | Daan/Lars |
| 4 | Security audit communicatie | ğŸ”´ Deze week | Bas/Daan |
| 5 | Bijlagen in berichten | ğŸŸ¡ Backlog | Daan/Lars |

**Gecombineerd inzicht:** Punten 1, 2 en 3 vormen samen een betere onboarding flow:
```
App Store/Instructies â†’ Config setup (< 5 min) â†’
OAuth trigger â†’ User in database â†’
Dashboard toont journey â†’ Developer tab voor API keys
```

---

## ChatGPT App Directory Submission Prep (2 feb 2026 - avond)

### Nieuwe Documentatie (PR #159)

| Document | Beschrijving |
|----------|--------------|
| `docs/app-stores/README.md` | Overzicht alle app store submissions |
| `docs/app-stores/CHATGPT-SUBMISSION.md` | Complete submission guide voor ChatGPT |
| `docs/app-stores/CLAUDE-CONNECTOR-SUBMISSION.md` | Documentatie Claude submission |

### ChatGPT Submission Materialen

| Item | Status | Details |
|------|--------|---------|
| App Metadata | âœ… Klaar | Naam, beschrijving, URLs |
| Demo Account | âœ… Klaar | `exa_demo` - geen login nodig |
| Test Cases | âœ… Klaar | 7 test scenarios gedocumenteerd |
| Tool Annotations | âœ… Klaar | Justificaties voor alle 47 tools |
| Privacy Statement | âœ… Klaar | Data handling gedocumenteerd |
| Submission Steps | âœ… Klaar | Stap-voor-stap instructies |

### Nog Te Doen voor Submission

| Actie | Eigenaar | Status |
|-------|----------|--------|
| OpenAI Platform account verifiÃ«ren | CEO | â¬œ TODO |
| Owner role controleren | CEO | â¬œ TODO |
| Screenshots maken | CEO | â¬œ TODO |
| App submitten | CEO | â¬œ TODO |

### Submission URL

```
https://platform.openai.com/apps-manage
```

### Documentatie Locatie

```
docs/app-stores/CHATGPT-SUBMISSION.md
```

---

## ğŸ”’ Security Spec Audit (3 feb 2026)

### Context
Security spec document v1.1 (`docs/security/SECURITY-SPEC-EXTERNAL-REVIEW.md`) geaudit door Bas en gefixed door Daan.

### Audit Resultaten (Bas)
| Ernst | Gevonden | Status |
|-------|----------|--------|
| P0 (Kritiek) | 0 | âœ… Clean |
| P1 (Hoog) | 5 | âœ… Gefixed |
| P2 (Medium) | 7 | âœ… Gefixed |

**Conclusie:** Core security implementatie (OAuth, encryptie, hashing) is solide. Issues waren documentatie-discrepanties.

### P1 Fixes (Daan) âœ…
| # | Issue | Fix |
|---|-------|-----|
| 1 | Session SameSite: spec=Strict, code=Lax | Spec â†’ Lax (OAuth requirement) |
| 2 | Session expiry: spec=7d, code=30d | Spec â†’ 30 dagen |
| 4 | CORS credentials header | Niet nodig - Bearer tokens |
| 5 | Open security items stale | Status â†’ âœ… Voltooid |

### P2 Fixes (Daan) âœ…
| # | Issue | Fix |
|---|-------|-----|
| 6 | Cookie naam: spec=session, code=session_id | Spec â†’ session_id |
| 7 | Database ID in spec | Verwijderd uit externe docs |
| 10 | State timestamp validatie | Spec aangepast: HMAC + nonce |
| 12 | X-XSS-Protection deprecated | Verwijderd uit middleware.ts |

### Nog Open (Lars/Dirk)
| # | Issue | Eigenaar | Status |
|---|-------|----------|--------|
| 3 | isEncrypted() verschilt tussen apps | Lars | ğŸ“‹ Backlog |
| 8 | innerHTML usage audit | Lars | ğŸ“‹ Backlog |
| 9 | Key rotation procedure docs | Dirk | ğŸ“‹ Backlog |
| 11 | Plan limieten consistentie | Lars | ğŸ“‹ Backlog |

### Gewijzigde Bestanden
- `docs/security/SECURITY-SPEC-EXTERNAL-REVIEW.md` â†’ v1.1
- `apps/auth-portal/src/middleware.ts` â†’ X-XSS-Protection verwijderd

---

*Aangemaakt: 2026-01-31 door Piet (Orchestrator)*
*Laatst bijgewerkt: 2026-02-03 door Piet*
*Brainstorm toegevoegd: 2026-02-02*
*ChatGPT submission prep: 2026-02-02*
*Security audit: 2026-02-03*
*Email communicatie infra: 2026-02-03*
*Template: 80% business, 20% tech - per Matthijs strategisch advies*

---

## ğŸ“§ Email Communicatie Infrastructuur (3 feb 2026)

### Voltooid: COMM-003 + COMM-004 (Unified Email System)

**Context:** Inbound emails gingen verloren, admin kon niet reageren vanuit dashboard.

### Gerealiseerde Functionaliteit

| Feature | API Endpoint | Status |
|---------|--------------|--------|
| **Inbound email webhook** | `POST /api/email/inbound` | âœ… Live |
| **Email van support@** (niet noreply@) | - | âœ… Live |
| **Spam/archive/delete conversations** | `DELETE/PATCH /api/admin/conversations/[id]` | âœ… Live |
| **Email aliases voor klanten** | `GET/POST/DELETE /api/admin/users/[id]/emails` | âœ… Live |
| **Admin reply opties** (email/dashboard) | `POST /api/admin/reply` | âœ… Live |
| **Opt-out PS in emails** | In admin reply emails | âœ… Live |

### Technische Details

**Inbound Email Flow:**
```
1. Klant stuurt email naar support@praatmetjeboekhouding.nl
2. Resend ontvangt â†’ webhook naar /api/email/inbound
3. Svix signature verificatie
4. User matching op email + aliases
5. Koppeling aan bestaande conversatie of nieuw aanmaken
6. Opslag in support_messages + communication_events
7. Admin alert email
```

**Admin Reply Opties:**
- `sendEmail: true` â†’ Email + dashboard bericht
- `sendEmail: false` â†’ Alleen dashboard (geen email)
- Non-customers â†’ Altijd email (verplicht)
- Respecteert `email_support_replies` user preference

**Nieuwe Database Objecten:**
- Tabel: `user_email_aliases`
- Status opties: `spam`, `archived`, `replied` toegevoegd aan `support_conversations`
- Migraties: `0027_conversation_spam_archive.sql`, `0028_user_email_aliases.sql`

### Resend Configuratie

```bash
# Vereiste environment variables (Cloudflare)
RESEND_API_KEY=re_xxx
RESEND_WEBHOOK_SECRET=whsec_xxx

# Webhook URL in Resend Dashboard
https://praatmetjeboekhouding.nl/api/email/inbound
Event: email.received
```

### PRs Gemerged
- #177: Inbound email webhook
- #178: Support@ als afzender
- #179: Conversation management (spam/archive/delete)
- #180: Email aliases systeem
- #181: Admin reply opties + opt-out PS
- #182-#189: Inbox UI improvements (filtering, tabs, bulk actions)
- #190: Thread view met gesprek context

### Admin Inbox Interface (3 feb - sessie 2)

**Nieuwe Pagina:** `/admin/inbox` - Centraal beheer van alle email communicatie

| Feature | Beschrijving |
|---------|--------------|
| **Tabs** | Inkomend (van klanten) / Verzonden (naar klanten) |
| **Filters** | Type (email, chat, support), Onbekende afzenders |
| **Bulk acties** | Selecteer meerdere berichten, verwijder in bulk |
| **Thread view** | Klik op bericht â†’ volledig gesprek met context |
| **Klant link** | Direct doorklikken naar klantprofiel |
| **Reply form** | Reageer direct vanuit thread view |

**API Endpoints:**
- `GET /admin/inbox` - Inbox overzicht
- `GET /admin/inbox/[id]` - Thread view
- `DELETE /api/admin/communications/[id]` - Verwijder enkel bericht
- `POST /api/admin/communications/bulk-delete` - Bulk verwijderen

**Email Loop Fix:**
Inbound emails van eigen domein (`@praatmetjeboekhouding.nl`, `@chefdata.nl`) worden nu genegeerd om oneindige loops te voorkomen.

**MX Record:**
```
praatmetjeboekhouding.nl MX â†’ inbound.resend.com (priority 10)
```

### Admin Signature Settings (3 feb - sessie 3) âœ…

**Feature:** Per-admin email handtekening voor support replies

| Component | Status | Beschrijving |
|-----------|--------|--------------|
| **Migration 0030** | âœ… Live | `email_signature` kolom op users tabel |
| **API Endpoint** | âœ… Live | `GET/POST /api/admin/signature` |
| **Settings UI** | âœ… Live | Handtekening editor in admin instellingen |
| **Inbox Integration** | âœ… Live | Signature auto-load in reply form |

**Nieuwe Capabilities:**
- Elke admin kan eigen handtekening instellen
- Default signature gebaseerd op admin naam
- Max 1000 karakters
- Signature wordt automatisch geladen bij replies in inbox
- Support voor outsourcing (verschillende admins, verschillende handtekeningen)

**API:**
- `GET /api/admin/signature` â†’ `{ signature: string, isDefault: boolean }`
- `POST /api/admin/signature` â†’ `{ signature: string }` (max 1000 chars)

**PR:** #194

---

## ğŸ”’ Compliance Audit W06 (4 feb 2026)

### Context
Op verzoek van Matthijs: compliance audit van alle nieuwe features sinds W05.

### Audit Resultaat
| Metric | Resultaat |
|--------|-----------|
| **Status** | ORANJE |
| **Score** | 7.8/10 |
| **Auditor** | Bas (Security Manager) |
| **Rapport** | `operations/audits/SECURITY-AUDIT-2026-W06.md` |

### Issues Overzicht

| # | Issue | Ernst | Eigenaar | Deadline |
|---|-------|-------|----------|----------|
| 1 | Webhook signature optioneel | **P2** | Daan | Di 4 feb |
| 2 | Geen rate limiting webhook | **P2** | Daan | Di 4 feb |
| 3 | Geen persistent audit log | **P2** | Daan | Di 4 feb |
| 4 | Basic email regex | P3 | Lars | Do 6 feb |
| 5 | LIKE query sanitization | P3 | Lars | Do 6 feb |
| 6 | Rate limiting reply API | P3 | Lars | Vr 7 feb |
| 7 | Basis spam filtering | P3 | Lars | W07 |

### P2 Fixes (Daan - Dinsdag)

**1. Webhook secret verplicht maken**
```typescript
// apps/auth-portal/src/pages/api/email/inbound.ts regel 329
if (!env.RESEND_WEBHOOK_SECRET) {
  console.error('[Inbound Email] RESEND_WEBHOOK_SECRET not configured');
  return new Response(JSON.stringify({ error: 'Server configuration error' }), {
    status: 500
  });
}
```

**2. Rate limiting webhook**
- Cloudflare Dashboard â†’ Security â†’ WAF â†’ Rate Limiting Rules
- Rule: `/api/email/inbound` max 60 req/min per IP

**3. Persistent audit logging**
```sql
-- Migration 0031_audit_log.sql
CREATE TABLE audit_log (
  id TEXT PRIMARY KEY,
  actor_id TEXT,
  actor_email TEXT,
  action TEXT NOT NULL,
  resource_type TEXT,
  resource_id TEXT,
  metadata TEXT,
  created_at TEXT DEFAULT (datetime('now'))
);
CREATE INDEX idx_audit_log_actor ON audit_log(actor_id);
CREATE INDEX idx_audit_log_action ON audit_log(action);
```

### Conclusie
Geen blokkers voor launch. P2 issues moeten dinsdag worden gefixed om status naar GROEN te brengen.

---

## âš–ï¸ Legal Audit W06 (4 feb 2026)

### Context
Op verzoek van Matthijs: legal audit van alle nieuwe features (email/support systeem).

### Audit Resultaat
| Metric | Resultaat |
|--------|-----------|
| **Status** | **ROOD** |
| **Score** | 4.75/10 |
| **Auditor** | Eva (CLO) |
| **Rapport** | `operations/audits/LEGAL-AUDIT-2026-W06.md` |

### Kritieke Bevindingen

| # | Issue | Ernst | Deadline |
|---|-------|-------|----------|
| 1 | **Resend niet als sub-verwerker gedocumenteerd** | P1 | **48 uur** |
| 2 | Support messages opslag niet in privacy policy | P1 | **48 uur** |
| 3 | Communication events niet vermeld | P1 | **48 uur** |

### Acties (KRITIEK - Woensdag 5 feb)

| Actie | Eigenaar | Status |
|-------|----------|--------|
| Privacy Policy v1.1 deployen | Eva + Lars | âœ… DONE (PR #200) |
| Resend toevoegen aan Verwerkersovereenkomst | Eva | âœ… DONE (PR #201) |
| ToS Artikel 4A (Support) toevoegen | Eva | âœ… DONE (PR #202) |

### Policy Updates Nodig

**Privacy Policy (sectie 2, 5, 6):**
- Support messages, email aliases, communication events toevoegen
- Resend als derde partij toevoegen
- Bewaartermijnen support data toevoegen

**Verwerkersovereenkomst (Bijlage 2):**
- Resend, Inc. toevoegen als sub-verwerker

**Terms of Service:**
- Nieuw Artikel 4A - Support Communicatie

### Conclusie
**Status: âœ… GROEN** - Alle policy updates zijn voltooid op 4 feb 2026 (binnen 24 uur na audit).

---

## ğŸš€ Autonome Uitvoering Dinsdag 4 feb 2026

### Orchestrator: Piet
### Methodiek: PDCA (Plan-Do-Check-Act) met juiste agents

### Voltooide Taken

| # | Taak | Agent | Status | PR |
|---|------|-------|--------|-----|
| 1 | AUDIT-P2: Webhook secret verplicht | Daan | âœ… | #197 |
| 2 | AUDIT-P2: Rate limiting docs | Daan | âœ… | #199 |
| 3 | AUDIT-P2: Audit log tabel | Daan | âœ… | #198 |
| 4 | LEGAL-P1: Privacy Policy v1.1 | Eva | âœ… | #200 |
| 5 | LEGAL-P1: Verwerkersovereenkomst v1.1 | Eva | âœ… | #201 |
| 6 | LEGAL-P2: ToS Artikel 4A | Eva | âœ… | #202 |
| 7 | Blog post 1 (BTW + AI) | Anna | âœ… | #203 |
| 8 | ChatGPT Apps docs | Ruben | âœ… | - |
| 9 | Demo script finaliseren | CEO | âœ… | #205 |
| 10 | AUDIT-P3: Email validatie | Lars | âœ… | #204 |
| 11 | AUDIT-P3: LIKE sanitization | Lars | âœ… | #204 |

### Handmatige Acties (Matthijs)

| Actie | Status | Instructie |
|-------|--------|------------|
| Cloudflare rate limiting configureren | â¬œ TODO | Zie docs/knowledge/backend/LESSONS-LEARNED.md |
| ChatGPT Apps account verifiÃ«ren | â¬œ TODO | Zie docs/app-stores/CHATGPT-SUBMISSION.md |
| ChatGPT App submitten | â¬œ TODO | Na account verificatie |
| Demo dry-run | â¬œ TODO | Zie docs/demo/EXACT-APP-STORE-DEMO.md |

### Resultaten

**Security Audit Status:** ORANJE â†’ âœ… GROEN
- P2 issues opgelost (webhook secret, audit log)
- P3 issues opgelost (email validatie, LIKE sanitization)
- Rate limiting gedocumenteerd (handmatige config nodig)

**Legal Audit Status:** ROOD â†’ âœ… GROEN
- Privacy Policy v1.1 live
- Verwerkersovereenkomst v1.1 live met Resend
- ToS v1.1 live met Artikel 4A Support

**Content:**
- Blog post live: BTW-overzicht opvragen met AI
- Demo script klaar: 5 minuten flow voor Exact App Store

### PRs Gemerged (11)

```
#197 fix: make RESEND_WEBHOOK_SECRET required
#198 feat: add audit log table and logging function
#199 docs: add Cloudflare WAF rate limiting instructions
#200 docs: update Privacy Policy to v1.1
#201 docs: update Verwerkersovereenkomst to v1.1
#202 docs: add ToS Article 4A Support Communication
#203 feat: add BTW + AI blog post
#204 fix: improve email validation and LIKE sanitization
#205 docs: add Exact App Store demo script
```

---

---

## ğŸ“ Content Machine Gestart (4 feb 2026)

### Strategische Shift
```
VAN: "Praat met je boekhouding" (query tool)
NAAR: "Automatiseer je boekhouding" (workflow hub)
```

### Workflow Recipes Content Plan
**Document:** `docs/marketing/WORKFLOW-RECIPES-CONTENT-PLAN.md`

| Metric | Target |
|--------|--------|
| Blogs per week | 2-3 |
| Recipe topics | 30 (6 categorieÃ«n) |
| Team | Tom (Lead), Lisa (Writer), Anna (Visual), Bram (SEO) |

### CategorieÃ«n
1. **Email + Boekhouding** - Factuurherinneringen, betalingsbevestigingen
2. **Spreadsheets + Boekhouding** - BTW exports, P&L naar Sheets
3. **To-Do/Project + Boekhouding** - Taken bij vervallende facturen
4. **Calendar + Boekhouding** - Betaaldeadlines, BTW herinneringen
5. **Slack/Teams + Boekhouding** - Cashflow updates, alerts
6. **Multi-Tool Chains** - Complete incasso workflows

### Eerste Blog Live
**Titel:** Automatische Factuurherinneringen met AI: Exact Online + Gmail Workflow
**Locatie:** `docs/marketing/blog/2026-02-04-automatische-factuurherinneringen-ai-workflow.md`
**PR:** #213

### BTW Disclaimer Richtlijnen
Alle BTW-gerelateerde content geframed als "voorbereiding":
- âœ… "BTW voorbereiding: overzicht exporteren naar Sheets"
- âŒ "BTW aangifte doen met AI"

**Verplichte disclaimer:**
> âš ï¸ Deze workflow helpt bij de voorbereiding van je BTW overzicht.
> Controleer de cijfers altijd in Exact Online voordat je aangifte doet.

---

*Laatst bijgewerkt: 2026-02-04 door Piet (Week 6 Afsluiting + Content Machine + P36 AI Support Agent)*

---

## ğŸ¤– P36: AI Support Agent met Email Escalatie (4 feb 2026)

### Context
Complete AI-powered support systeem geÃ¯mplementeerd als upgrade van het bestaande pattern-based support systeem.

### Gerealiseerde Functionaliteit

#### Email Infrastructuur
| Feature | Bestand | Status |
|---------|---------|--------|
| **Reply-To support** | `email.ts` | âœ… Live |
| **Escalatie email template** | `email.ts` | âœ… Live |
| **Acknowledgment emails** | `email.ts` | âœ… Live |
| **Parse support+{id}@** | `inbound.ts` | âœ… Live |
| **Admin reply routing** | `inbound.ts` | âœ… Live |

#### Guard Rails (KRITIEK)
| Guard Rail | Beschrijving | Configuratie |
|------------|--------------|--------------|
| **Human Request Detection** | 15 patterns (NL + EN) | Immediate escalation |
| **Response Limit** | Max 5 AI responses | Auto-escalate na limiet |
| **Content Filtering** | Blocked patterns | Refunds, wachtwoorden, etc. |
| **Confidence Threshold** | < 0.5 | Auto-escalate |

#### Support Agent Tools
| Tool | Beschrijving | Status |
|------|--------------|--------|
| `escalate_to_admin` | Email naar admin + klant info | âœ… NEW |
| `get_customer_history` | Bekijk eerdere gesprekken | âœ… NEW |
| `get_plan_usage` | Check plan limieten | âœ… NEW |
| `respond_to_customer` | Nu met guard rails | âœ… UPDATED |

#### Kennisbank
| Feature | Beschrijving | Status |
|---------|--------------|--------|
| **"Toevoegen aan Kennisbank" knop** | In admin conversation page | âœ… Live |
| **to-article API endpoint** | AI-powered artikel generatie | âœ… Live |

### Email Flow Diagram
```
Klant email â†’ support@praatmetjeboekhouding.nl
         â†“
    Inbound webhook
         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Is support+{id}@?                   â”‚
â”‚ â”œâ”€ Ja + Admin afzender â†’ Admin replyâ”‚
â”‚ â”‚        â†’ Notify klant             â”‚
â”‚ â”‚        â†’ Trigger AI met instructieâ”‚
â”‚ â”œâ”€ Ja + Klant afzender â†’ Add messageâ”‚
â”‚ â””â”€ Nee â†’ Nieuw gesprek              â”‚
â”‚          â†’ Send acknowledgment      â”‚
â”‚          â†’ Trigger AI               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â†“
    AI Support Agent
         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Guard Rails Check:                  â”‚
â”‚ 1. Wil klant mens? â†’ Escaleer       â”‚
â”‚ 2. Response limiet? â†’ Escaleer      â”‚
â”‚ 3. Low confidence? â†’ Escaleer       â”‚
â”‚ 4. Admin instructie? â†’ Volg op      â”‚
â”‚ 5. Pattern match? â†’ Antwoord        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### PR
- #227: feat(support): implement AI support agent with email escalation loop

### Eigenaren
- **Implementatie:** Claude (AI)
- **Review:** Daan (Backend)
- **Documentatie:** Petra (Support)

---

## ğŸ§¹ GitHub Hygiene Sessie (4 feb 2026 - avond)

### Context
Matthijs meldde: "Ik heb er weer een potje van gemaakt" - PRs die niet konden mergen, CI errors. Piet voerde een complete cleanup uit.

### Uitgevoerde Acties

| Actie | Status | Details |
|-------|--------|---------|
| **Git sync** | âœ… | Lokaal 2 commits achter op origin |
| **PR #230 opgeruimd** | âœ… | Was leeg na rebase (changes al in main) |
| **6 stale branches verwijderd** | âœ… | Remote + lokaal opgeruimd |
| **CI errors gefixed** | âœ… | TypeScript type assertions toegevoegd |
| **Lessons learned gedocumenteerd** | âœ… | 3 nieuwe lessen in LESSONS-LEARNED.md |

### Verwijderde Branches
```
claude/desktop-connector-bug-notice
claude/fix-mcp-endpoint-path
claude/fix-piet-type-errors-oNsxc
claude/setup-page-oauth-urls
claude/simplify-urls-oauth
content/workflow-recipe-invoice-reminders
```

### PRs Gemerged (avondsessie)
| PR | Beschrijving |
|----|--------------|
| #231 | fix: add type assertions to conversation page script |
| #232 | docs: add lessons learned from 2026-02-04 session |

### CI Errors Gefixed

**Probleem:** TypeScript errors in `[id].astro`:
- `Property 'disabled' does not exist on type 'HTMLElement'`
- `'data' is of type 'unknown'`

**Oplossing:**
```typescript
// Cast naar specifiek element type
const addBtn = document.getElementById('...') as HTMLButtonElement | null;

// Type de API response
const data = await response.json() as { error?: string; suggested_article?: {...} };
```

### Gedocumenteerde Lessen
1. **Stale branches blokkeren CI** - Start sessie met hygiene check
2. **HTMLElement types in Astro** - Cast DOM elements naar specifieke types
3. **Lege PR na rebase** - Check diff voor duplicate work

### Eindstatus
| Item | Status |
|------|--------|
| Open PRs | 0 âœ… |
| Remote branches | 1 (main only) âœ… |
| CI Status | GROEN âœ… |
| TypeScript | Geen errors âœ… |

---

## ğŸ“Š Week 6 Samenvatting (4 feb 2026)

### Totaal Gemerged PRs Vandaag: 55+

**CategorieÃ«n:**
| Categorie | PRs | Highlights |
|-----------|-----|------------|
| **P36 AI Support** | #225-228 | Complete AI agent met email escalatie |
| **Dashboard Features** | #219-224 | Klantreis dashboard, Developer page |
| **Security Audit** | #197-199, #204 | Webhook secret, audit log, input validation |
| **Legal Compliance** | #200-202 | Privacy Policy v1.1, ToS v1.1 |
| **Content** | #203, #213, #216 | BTW blog, workflow recipes |
| **Setup/Onboarding** | #209-212 | OAuth URLs, MCP path fixes |
| **GitHub Hygiene** | #229, #231, #232 | CI fixes, lessons learned |

### Audit Status Update
| Audit | Start | Eind |
|-------|-------|------|
| **Security** | ORANJE (7.8/10) | âœ… GROEN |
| **Legal** | ROOD (4.75/10) | âœ… GROEN |

### Week 6 Doelen - Status
| Doel | Status |
|------|--------|
| P36 AI Support Agent | âœ… LIVE |
| Security audit naar groen | âœ… DONE |
| Legal audit naar groen | âœ… DONE |
| Demo script klaar | âœ… DONE |
| Content machine gestart | âœ… DONE |
| ChatGPT Apps submission | â¬œ Account verificatie nodig |
| Cloudflare rate limiting | â¬œ Handmatige config nodig |

---

---

## ğŸš¨ ISSUE-004: Blog Leesbaarheid (5 feb 2026)

### Context
Matthijs reviewde de blogs en constateerde: "Die zijn niet te lezen door mensen."

### Probleem
| Aspect | Status |
|--------|--------|
| **Visuele blokken** | âŒ Ontbreken |
| **Whitespace** | âŒ Te weinig |
| **Technische taal** | âŒ Tool-namen i.p.v. benefits |
| **Paragraaflengte** | âŒ Te lang |

### Vergelijking
Beurs van Berlage blog als goed voorbeeld:
- Veel witruimte tussen secties
- Bold headers met ruimte
- Korte paragrafen (2-3 zinnen)
- Visuele onderbrekingen

### Root Cause
1. **CSS:** Tailwind `prose` class geeft onvoldoende spacing
2. **Content:** Geschreven als feature-lijsten, niet als verhaal

### Actie
| Taak | Eigenaar | Prioriteit |
|------|----------|------------|
| CSS spacing fix (h2 margin, section dividers) | Lars | ğŸ”´ HOOG |
| Blog content rewrite richtlijnen | Tom | ğŸ”´ HOOG |
| Bestaande blogs herschrijven | Anna + Lisa | ğŸŸ¡ MEDIUM |

### Documentatie
- KNOWN-ISSUES.md: ISSUE-004
- Lessons Learned: `docs/knowledge/marketing/VERSION.md`

---

*Laatst bijgewerkt: 2026-02-05 08:55 door Piet (ISSUE-004 Blog Leesbaarheid)*
