# Exact Online MCP Server
# Cloudflare Worker that provides MCP protocol access to Exact Online data
name = "exact-mcp-api"
main = "src/index.ts"
compatibility_date = "2024-09-23"
compatibility_flags = ["nodejs_compat"]

# P15-CRON: Scheduled trigger for proactive token refresh
# Runs every 5 minutes to refresh tokens expiring soon
[triggers]
crons = ["*/5 * * * *"]

# Use Workers Unbound for longer CPU time (no 10ms/50ms limit)
# Note: This enables usage-based billing instead of flat rate
# See: https://developers.cloudflare.com/workers/platform/pricing/
usage_model = "unbound"

# Enable observability (logs, traces)
[observability]
enabled = true

# Observability settings
[observability.logs]
enabled = true
invocation_logs = true
head_sampling_rate = 1  # Log 100% of requests

# D1 Database binding (shared with auth-portal)
[[d1_databases]]
binding = "DB"
database_name = "exact-mcp-db"
database_id = "30788ed4-4a60-4453-b176-dd9da7eecb2d"

# Development
[env.development]
vars = { ENVIRONMENT = "development" }

# Production
[env.production]
name = "exact-mcp-api"
vars = { ENVIRONMENT = "production" }

# Custom domain route for production
[[env.production.routes]]
pattern = "api.praatmetjeboekhouding.nl"
custom_domain = true

[[env.production.d1_databases]]
binding = "DB"
database_name = "exact-mcp-db"
database_id = "30788ed4-4a60-4453-b176-dd9da7eecb2d"

